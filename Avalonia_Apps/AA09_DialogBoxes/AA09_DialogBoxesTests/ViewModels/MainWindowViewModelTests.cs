using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using System.Windows;
using MsBox.Avalonia.Enums;
using Avalonia.ViewModels;
using AA16_UserControl1.ViewModels;

namespace AA09_DialogBoxes.ViewModels.Tests;

[TestClass()]
public class MainWindowViewModelTests : BaseTestViewModel
{
#pragma warning disable CS8618 // Ein Non-Nullable-Feld muss beim Beenden des Konstruktors einen Wert ungleich NULL enthalten. Erwägen Sie die Deklaration als Nullable.
    /// <summary>
    /// The test model
    /// </summary>
    /// <autogeneratedoc />
    MainWindowViewModel testModel;
    ButtonResult mbResult;
    (string name, string email) tResult;
#pragma warning restore CS8618 // Ein Non-Nullable-Feld muss beim Beenden des Konstruktors einen Wert ungleich NULL enthalten. Erwägen Sie die Deklaration als Nullable.

    /// <summary>
    /// Initializes this instance.
    /// </summary>
    /// <autogeneratedoc />
    [TestInitialize]
    public void Init()
    {
        testModel = new();
        testModel.PropertyChanged += OnVMPropertyChanged;
        if (testModel is INotifyPropertyChanging npchgn)
            npchgn.PropertyChanging += OnVMPropertyChanging;
        testModel.DoOpenDialog += DoOpenDialogTest;
        testModel.DoOpenMessageBox += DoOpenMessageBoxTest;
        ClearLog();
    }

    private ButtonResult DoOpenMessageBoxTest(string title, string name)
    {
        DoLog($"DoOpenMessageBox({title},{name})=>{mbResult}");
        return mbResult;
    }

    private (string name, string email) DoOpenDialogTest(string name, string email)
    {
        DoLog($"DoOpenMessageBox({name},{email})=>{tResult}");
        return tResult;
    }

    /// <summary>
    /// Defines the test method SetupTest.
    /// </summary>
    /// <autogeneratedoc />
    [TestMethod()]
    public void SetupTest()
    {
        Assert.IsNotNull(testModel);
        Assert.IsInstanceOfType(testModel, typeof(MainWindowViewModel));
        Assert.IsInstanceOfType(testModel, typeof(BaseViewModelCT));
        Assert.IsInstanceOfType(testModel, typeof(INotifyPropertyChanged));
        Assert.IsNotNull(testModel.OpenMsgCommand);
        Assert.IsInstanceOfType(testModel.OpenMsgCommand, typeof(IRelayCommand));
        Assert.IsNotNull(testModel.OpenDialogCommand);
        Assert.IsInstanceOfType(testModel.OpenDialogCommand, typeof(IRelayCommand));
    }

    [DataTestMethod()]
    [DataRow(true,ButtonResult.Yes, new[] { @"DoOpenMessageBox(Frage,Willst Du Das ?)=>Yes
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestNameTrue
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=42 Entwickler
", "42 Entwickler" })]
    [DataRow(false, ButtonResult.Ok, new[] { @"PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestNameFalse
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=Nö
", "Nö" })]
    [DataRow(null, ButtonResult.No, new[] { @"DoOpenMessageBox(Frage,Willst Du Das ?)=>No
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestName
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=Nö
", "Nö" })]
    public void OpenMsgCommandTest(bool? oAct,ButtonResult mrExp, string[] asExp)
    {
        // Arrange
        testModel.Name = $"TestName{oAct}";
        if (oAct == false) testModel.DoOpenMessageBox -= DoOpenMessageBoxTest;
        mbResult = mrExp;
        ClearLog();

        // Act
        Assert.IsTrue(testModel.OpenMsgCommand.CanExecute(oAct));
        testModel.OpenMsgCommand.Execute(oAct);

        // Assert
        Assert.AreEqual(asExp[1], testModel.Name);
        Assert.AreEqual(asExp[0], DebugLog);
    }

    [DataTestMethod()]
    [DataRow(true,"0", new[] { @"DoOpenMessageBox(TestNameTrue,TestEmailTrue)=>(TestName0, TestMail0)
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestNameTrue
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestName0
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=TestEmailTrue
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=TestMail0
", "TestName0", "TestMail0" })]
    [DataRow(false, "1", new[] { @"PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestNameFalse
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=TestEmailFalse
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=
", "","" })]
    [DataRow(null, "2", new[] { @"DoOpenMessageBox(TestName,TestEmail)=>(TestName2, TestMail2)
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestName
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=2
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Cnt)=3
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Name)=TestName2
PropChgn(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=TestEmail
PropChg(MVVM_09a_CTDialogBoxes.ViewModels.MainWindowViewModel,Email)=TestMail2
", "TestName2", "TestMail2" })]
    public void OpenDialogCommandTest(bool? oAct,string sAct, string[] asExp)
    {
        // Arrange
        testModel.Name = $"TestName{oAct}";
        testModel.Email = $"TestEmail{oAct}";
        tResult = ($"TestName{sAct}", $"TestMail{sAct}");
        if (oAct == false) testModel.DoOpenDialog -= DoOpenDialogTest;
        ClearLog();

        // Act    
        Assert.IsTrue(testModel.OpenDialogCommand.CanExecute(oAct));
        testModel.OpenDialogCommand.Execute(oAct);
        
        // Assert
        Assert.AreEqual(asExp[1], testModel.Name);
        Assert.AreEqual(asExp[2], testModel.Email);
        Assert.AreEqual(asExp[0], DebugLog);
    }
}
