<UserControl x:Class="DataAnalysis.WPF.Views.Controls.ClusterAggregationView"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
 xmlns:plot="clr-namespace:DataAnalysis.WPF.Views.Converters"
 mc:Ignorable="d">
	<UserControl.Resources>
		<plot:PlotXConverter x:Key="PlotXConverter"/>
		<plot:PlotYConverter x:Key="PlotYConverter"/>
		<plot:SizeByCountConverter x:Key="SizeByCountConverter"/>
	</UserControl.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="50"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="20"/>
			</Grid.ColumnDefinitions>
			<Grid.RowDefinitions>
				<RowDefinition Height="20"/>
				<RowDefinition Height="*"/>
				<RowDefinition Height="30"/>
			</Grid.RowDefinitions>
			<!-- Plot host fills cell -->
			<Grid x:Name="PlotHost" Grid.Row="1" Grid.Column="1" Background="#0E000000">
				<!-- raw points overlay -->
				<ItemsControl ItemsSource="{Binding RawPoints}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<Canvas/>
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemContainerStyle>
						<Style TargetType="ContentPresenter">
							<Setter Property="Canvas.Left">
								<Setter.Value>
									<MultiBinding Converter="{StaticResource PlotXConverter}">
										<Binding Path="X"/>
										<Binding Path="DataContext.MinX" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding Path="DataContext.MaxX" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding ElementName="PlotHost" Path="ActualWidth"/>
									</MultiBinding>
								</Setter.Value>
							</Setter>
							<Setter Property="Canvas.Top">
								<Setter.Value>
									<MultiBinding Converter="{StaticResource PlotYConverter}">
										<Binding Path="Y"/>
										<Binding Path="DataContext.MinY" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding Path="DataContext.MaxY" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding ElementName="PlotHost" Path="ActualHeight"/>
									</MultiBinding>
								</Setter.Value>
							</Setter>
						</Style>
					</ItemsControl.ItemContainerStyle>
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Ellipse Width="4" Height="4" Fill="#404040" Stroke="#808080" StrokeThickness="0.5"/>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>

				<!-- cluster bubbles overlay -->
				<ItemsControl ItemsSource="{Binding Points}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<Canvas/>
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemContainerStyle>
						<Style TargetType="ContentPresenter">
							<Setter Property="Canvas.Left">
								<Setter.Value>
									<MultiBinding Converter="{StaticResource PlotXConverter}">
										<Binding Path="X"/>
										<Binding Path="DataContext.MinX" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding Path="DataContext.MaxX" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding ElementName="PlotHost" Path="ActualWidth"/>
									</MultiBinding>
								</Setter.Value>
							</Setter>
							<Setter Property="Canvas.Top">
								<Setter.Value>
									<MultiBinding Converter="{StaticResource PlotYConverter}">
										<Binding Path="Y"/>
										<Binding Path="DataContext.MinY" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding Path="DataContext.MaxY" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
										<Binding ElementName="PlotHost" Path="ActualHeight"/>
									</MultiBinding>
								</Setter.Value>
							</Setter>
						</Style>
					</ItemsControl.ItemContainerStyle>
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Ellipse StrokeThickness="1">
								<Ellipse.Fill>
									<SolidColorBrush Color="#7F2D89EF"/>
								</Ellipse.Fill>
								<Ellipse.Stroke>
									<SolidColorBrush Color="#2D89EF"/>
								</Ellipse.Stroke>
								<Ellipse.Width>
									<MultiBinding Converter="{StaticResource SizeByCountConverter}">
										<Binding Path="Count"/>
										<Binding Path="DataContext.MaxCount" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
									</MultiBinding>
								</Ellipse.Width>
								<Ellipse.Height>
									<MultiBinding Converter="{StaticResource SizeByCountConverter}">
										<Binding Path="Count"/>
										<Binding Path="DataContext.MaxCount" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
									</MultiBinding>
								</Ellipse.Height>
								<Ellipse.ToolTip>
									<StackPanel>
										<TextBlock Text="{Binding X, StringFormat='X={0:F1}'}"/>
										<TextBlock Text="{Binding Y, StringFormat='Y={0:F1}'}"/>
										<TextBlock Text="{Binding Count, StringFormat='Count={0}'}"/>
									</StackPanel>
								</Ellipse.ToolTip>
								<Ellipse.Style>
									<Style TargetType="Ellipse">
										<Setter Property="Opacity" Value="0.8"/>
										<Style.Triggers>
											<Trigger Property="IsMouseOver" Value="True">
												<Setter Property="Fill">
													<Setter.Value>
														<SolidColorBrush Color="#FF2D89EF"/>
													</Setter.Value>
												</Setter>
												<Setter Property="Stroke">
													<Setter.Value>
														<SolidColorBrush Color="#FF1B5E9E"/>
													</Setter.Value>
												</Setter>
											</Trigger>
										</Style.Triggers>
									</Style>
								</Ellipse.Style>
							</Ellipse>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</Grid>
		</Grid>
	</Grid>
</UserControl>
