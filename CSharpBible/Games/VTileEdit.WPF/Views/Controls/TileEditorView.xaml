<UserControl
    x:Class="VTileEdit.WPF.Views.Controls.TileEditorView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:VTileEdit.WPF.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:VTileEdit.WPF.Properties"
    xmlns:vm="clr-namespace:VTileEdit.WPF.ViewModels"
    d:Height="400"
    d:Width="600"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Style x:Key="GlyphButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
        </Style>
        <converters:WidthToHeightConverter x:Key="WidthToHeightConverter" Ratio="2" />
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <GroupBox Margin="0,0,0,8" Header="{x:Static properties:Strings.PreviewHeader}">
            <Viewbox
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Stretch="Uniform"
                StretchDirection="Both">
                <ItemsControl ItemsSource="{Binding SelectedTile.Glyphs}">
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                            <Setter Property="VerticalAlignment" Value="Stretch" />
                            <Setter Property="Height">
                                <Setter.Value>
                                    <Binding
                                        Converter="{StaticResource WidthToHeightConverter}"
                                        Path="ActualWidth"
                                        RelativeSource="{RelativeSource Self}" />
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="{Binding SelectedTile.TileWidth}" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:GlyphCellViewModel}">
                            <Border
                                Margin="1"
                                Background="{Binding BackgroundBrush}"
                                BorderBrush="#22000000"
                                BorderThickness="0.5">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#22000000" />
                                        <Setter Property="BorderThickness" Value="0.5" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                <Setter Property="BorderBrush" Value="#FF5A9BD8" />
                                                <Setter Property="BorderThickness" Value="2" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button
                                    Command="{Binding DataContext.SelectGlyphCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource GlyphButtonStyle}">
                                    <Viewbox
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        Stretch="Uniform">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontFamily="{Binding DataContext.SelectedFontFamily, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            FontSize="16"
                                            Foreground="{Binding ForegroundBrush}"
                                            Text="{Binding Character}" />
                                    </Viewbox>
                                </Button>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Viewbox>
        </GroupBox>
        <GroupBox Grid.Column="1" Header="{x:Static properties:Strings.GlyphDetailsHeader}">
            <StackPanel Margin="8" Orientation="Vertical">
                <TextBlock
                    Margin="8,0,8,0"
                    VerticalAlignment="Center"
                    Text="{x:Static properties:Strings.GlyphCharacterLabel}" />
                <TextBox
                    Grid.Column="1"
                    HorizontalContentAlignment="Center"
                    FontFamily="{Binding SelectedFontFamily}"
                    FontSize="16"
                    Text="{Binding SelectedGlyph.CharacterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock
                    Grid.Row="1"
                    Margin="8,12,8,0"
                    VerticalAlignment="Center"
                    Text="{x:Static properties:Strings.GlyphForegroundLabel}" />
                <ComboBox
                    Grid.Row="1"
                    Grid.Column="1"
                    ItemsSource="{Binding Palette}"
                    SelectedItem="{Binding SelectedForegroundSwatch}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:ColorSwatchViewModel}">
                            <StackPanel Orientation="Horizontal">
                                <Rectangle
                                    Width="16"
                                    Height="16"
                                    Margin="0,0,6,0"
                                    Fill="{Binding Brush}"
                                    Stroke="#33000000"
                                    StrokeThickness="1" />
                                <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <TextBlock
                    Grid.Row="2"
                    Margin="8,12,8,0"
                    VerticalAlignment="Center"
                    Text="{x:Static properties:Strings.GlyphBackgroundLabel}" />
                <ComboBox
                    Grid.Row="2"
                    Grid.Column="1"
                    ItemsSource="{Binding Palette}"
                    SelectedItem="{Binding SelectedBackgroundSwatch}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:ColorSwatchViewModel}">
                            <StackPanel Orientation="Horizontal">
                                <Rectangle
                                    Width="16"
                                    Height="16"
                                    Margin="0,0,6,0"
                                    Fill="{Binding Brush}"
                                    Stroke="#33000000"
                                    StrokeThickness="1" />
                                <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>
        </GroupBox>
    </Grid>
</UserControl>
