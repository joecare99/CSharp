<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="VTileEdit.WPF.Views.Controls.TileListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:VTileEdit.WPF.Converters"
    xmlns:properties="clr-namespace:VTileEdit.WPF.Properties"
    xmlns:vm="clr-namespace:VTileEdit.WPF.ViewModels">
    <UserControl.Resources>
        <converters:WidthToHeightConverter x:Key="WidthToHeightConverter" Ratio="2" />
    </UserControl.Resources>
    <GroupBox Header="{x:Static properties:Strings.TileListHeader}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <TextBlock
                Grid.Row="0"
                Margin="0,0,0,8"
                Foreground="Gray"
                Text="{x:Static properties:Strings.TileListHint}" />
            <DockPanel Grid.Row="1" Margin="0,0,0,8">
                <TextBlock
                    Margin="0,0,8,0"
                    VerticalAlignment="Center"
                    Text="{x:Static properties:Strings.TileListFilterLabel}" />
                <TextBox Text="{Binding TileFilterText, UpdateSourceTrigger=PropertyChanged}" />
            </DockPanel>
            <ListBox
                Grid.Row="2"
                ItemsSource="{Binding TilesView}"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                SelectedItem="{Binding SelectedTile}">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:TileViewModel}">
                        <StackPanel Width="100" Margin="0,0,8,8">
                            <TextBlock FontWeight="Bold" Text="{Binding DisplayName}" />
                            <ItemsControl ItemsSource="{Binding Glyphs}">
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                                        <Setter Property="VerticalAlignment" Value="Stretch" />
                                        <Setter Property="Height">
                                            <Setter.Value>
                                                <Binding
                                                    Converter="{StaticResource WidthToHeightConverter}"
                                                    Path="ActualWidth"
                                                    RelativeSource="{RelativeSource Self}" />
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="{Binding TileWidth}" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type vm:GlyphCellViewModel}">
                                        <Border
                                            Background="{Binding BackgroundBrush}"
                                            BorderBrush="#22000000"
                                            BorderThickness="0.5">
                                            <Viewbox
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                Stretch="Uniform">
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    FontFamily="{Binding DataContext.SelectedFontFamily, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    FontSize="10"
                                                    Foreground="{Binding ForegroundBrush}"
                                                    Text="{Binding Character}" />
                                            </Viewbox>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </GroupBox>
</UserControl>
